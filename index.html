<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supercar Sound Quiz</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <h1>Supercar Sound Quiz ğŸï¸</h1>

    <div id="start-screen" class="card">
        <h2>GAME SETUP</h2>
        <p style="color:#aaa; font-size:0.9em; margin-bottom:20px;">
            ã‚¹ãƒ¼ãƒ‘ãƒ¼ã‚«ãƒ¼ã®ã‚¨ãƒ³ã‚¸ãƒ³éŸ³ã‚’èã„ã¦è»Šç¨®ã‚’å½“ã¦ã‚ˆã†ï¼<br>
            å…¨ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ ã«10å•å‡ºé¡Œã•ã‚Œã¾ã™ã€‚
        </p>
        
        <div class="mode-group">
            <span style="color:#aaa; display:block; margin-bottom:5px;">ãƒ¢ãƒ¼ãƒ‰é¸æŠ</span>
            <div class="selection-grid">
                <button class="select-btn" id="btn-mode-time" onclick="selectMode(true)">ã‚¿ã‚¤ãƒ ã‚¢ã‚¿ãƒƒã‚¯</button>
                <button class="select-btn" id="btn-mode-relax" onclick="selectMode(false)">ãƒªãƒ©ãƒƒã‚¯ã‚¹</button>
            </div>
        </div>
        <button id="start-btn" class="big-start-btn" onclick="startGame()" disabled>START GAME</button>
    </div>

    <div id="game-screen">
        <div class="game-header">
            <span id="progress-text">Q 1 / 10</span>
            <div class="header-right">
                <span style="color:#f1c40f; font-weight:bold;">SCORE: <span id="score">0</span></span>
                <button class="menu-btn" onclick="backToMenu()">ãƒ¡ãƒ‹ãƒ¥ãƒ¼</button>
            </div>
        </div>
        
        <div id="timer-wrapper" style="margin-top:5px; display:none;">
            <div style="background:#333; height:8px; border-radius:4px; overflow:hidden;">
                <div id="timer-bar" class="timer-bar"></div>
            </div>
            <div style="text-align:right; font-size:0.8em; color:#aaa; margin-top:2px;">æ®‹ã‚Š <span id="time-left">10</span> ç§’</div>
        </div>
        <div id="quiz-area" class="card"></div>
    </div>

    <div id="final-screen" class="card">
        <h2>FINISH!</h2>
        <div style="font-size:4em; color:#f1c40f; margin:20px 0;" id="final-score">0</div>
        <p id="rank-comment" style="font-size:1.2em; font-weight:bold;"></p>
        <button class="btn" style="background:#3498db; margin-top:20px;" onclick="location.reload()">ã‚¿ã‚¤ãƒˆãƒ«ã«æˆ»ã‚‹</button>
    </div>

    <script>
        // ==========================================
        // ğŸµ ã‚ªãƒ¼ãƒ‡ã‚£ã‚ª & åŠ¹æœéŸ³ã‚·ã‚¹ãƒ†ãƒ 
        // ==========================================
        let currentAudio = null; 
        
        function playEngineSound(fileName) {
            if (currentAudio) {
                currentAudio.pause();
                currentAudio.onended = null;
                currentAudio.currentTime = 0;
            }
            if (!fileName) return;

            currentAudio = new Audio(fileName);
            currentAudio.play().catch(e => {
                console.log("è‡ªå‹•å†ç”Ÿãƒ–ãƒ­ãƒƒã‚¯:", e);
            });

            const icon = document.getElementById('sound-icon');
            if(icon) {
                icon.classList.add('sound-playing');
                currentAudio.addEventListener('ended', () => {
                   if(icon) icon.classList.remove('sound-playing');
                });
            }
        }

        function stopEngineSound() {
            if (currentAudio) {
                currentAudio.pause();
                currentAudio.onended = null;
                currentAudio = null;
            }
            const icon = document.getElementById('sound-icon');
            if(icon) icon.classList.remove('sound-playing');
        }

        let audioCtx;
        function playSE(type) {
            if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            if (audioCtx.state === 'suspended') audioCtx.resume();

            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            const now = audioCtx.currentTime;
            if (type === 'correct') {
                osc.type = 'sine'; osc.frequency.setValueAtTime(880, now); osc.frequency.setValueAtTime(1760, now + 0.1);
                gain.gain.setValueAtTime(0.1, now); gain.gain.linearRampToValueAtTime(0, now + 0.3);
            } else {
                osc.type = 'sawtooth'; osc.frequency.setValueAtTime(150, now); osc.frequency.linearRampToValueAtTime(100, now + 0.3);
                gain.gain.setValueAtTime(0.1, now); gain.gain.linearRampToValueAtTime(0, now + 0.3);
            }
            osc.start(now); osc.stop(now + 0.3); osc.connect(gain); gain.connect(audioCtx.destination);
        }

        // ==========================================
        // ğŸ® ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯
        // ==========================================
        let isTimerMode = null;      
        let currentQuestions = [];
        let currentIndex = 0;
        let score = 0;
        let timerInterval;
        let timeLeft = 10;
        let isAnswered = false;

        function selectMode(mode) {
            isTimerMode = mode;
            document.getElementById('btn-mode-time').classList.remove('selected');
            document.getElementById('btn-mode-relax').classList.remove('selected');
            document.getElementById(mode ? 'btn-mode-time' : 'btn-mode-relax').classList.add('selected');
            document.getElementById('start-btn').disabled = false;
        }

        function startGame() {
            // é…åˆ—ã‚’ã‚³ãƒ”ãƒ¼
            let shuffled = [...soundQuizzes];
            
            // Fisher-Yates ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã§ãƒ©ãƒ³ãƒ€ãƒ ã«ä¸¦ã¹æ›¿ãˆ
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }

            // å…ˆé ­ã‹ã‚‰10å€‹ã‚’å–å¾—ï¼ˆãƒ‡ãƒ¼ã‚¿ãŒ10å€‹æœªæº€ã®å ´åˆã¯å…¨ã¦å–å¾—ï¼‰
            currentQuestions = shuffled.slice(0, 10);

            document.getElementById('start-screen').style.display = 'none';
            document.getElementById('game-screen').style.display = 'block';
            if (isTimerMode) document.getElementById('timer-wrapper').style.display = 'block';
            loadQuestion();
        }

        function backToMenu() {
            location.reload();
        }

        function loadQuestion() {
            isAnswered = false;
            stopEngineSound(); 

            const q = currentQuestions[currentIndex];
            document.getElementById('progress-text').innerText = `Q ${currentIndex + 1} / ${currentQuestions.length}`;
            
            let statusText = "Now Playing...";
            if (isTimerMode) {
                statusText = "éŸ³å£°ç¢ºèªä¸­... (å†ç”Ÿçµ‚äº†å¾Œã«è¨ˆæ¸¬é–‹å§‹)";
            }
            
            let mediaHTML = `<div id="sound-area" class="sound-container">
                <div class="sound-icon" id="sound-icon" onclick="playEngineSound('${q.soundFile}')"></div>
                <p id="sound-status" style="color:#e74c3c; font-size:0.9em; margin-top:10px; font-weight:bold;">${statusText}</p>
            </div>
            <div id="video-area" class="video-wrapper"></div>`;

            let buttonsHTML = '<div class="options-grid">';
            q.o.forEach((opt, idx) => {
                buttonsHTML += `<button class="btn option-btn" onclick="checkAnswer(${idx}, this)">${opt}</button>`;
            });
            buttonsHTML += '</div>';

            document.getElementById('quiz-area').innerHTML = `<h2 style="margin:0 0 10px 0;">${q.q}</h2>${mediaHTML}${buttonsHTML}<div id="result-msg" style="min-height:30px; margin-top:15px; font-weight:bold;"></div><button id="next-btn" class="btn" style="background:#3498db; margin-top:10px; display:none;" onclick="goNext()">æ¬¡ã®å•é¡Œã¸ >></button>`;

            setTimeout(() => {
                playEngineSound(q.soundFile);

                if (isTimerMode) {
                    if(currentAudio) {
                        currentAudio.onended = function() {
                            if(!isAnswered) { 
                                playEngineSound(q.soundFile); 
                                const statusEl = document.getElementById('sound-status');
                                if(statusEl) statusEl.innerText = "è¨ˆæ¸¬ã‚¹ã‚¿ãƒ¼ãƒˆï¼";
                                startTimer();
                                currentAudio.onended = null; 
                            }
                        };
                    }
                }
            }, 500);
        }

        function startTimer() {
            timeLeft = 10;
            updateTimerUI();
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimerUI();
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    timeUp();
                }
            }, 1000);
        }

        function updateTimerUI() {
            document.getElementById('time-left').innerText = timeLeft;
            document.getElementById('timer-bar').style.width = (timeLeft * 10) + "%";
        }

        function timeUp() {
            if(isAnswered) return;
            checkAnswer(-1, null);
        }

        function checkAnswer(idx, btn) {
            if (isAnswered) return;
            isAnswered = true;
            clearInterval(timerInterval);
            stopEngineSound();

            const q = currentQuestions[currentIndex];
            const allBtns = document.querySelectorAll('.option-btn');
            const resultMsg = document.getElementById('result-msg');
            
            const soundArea = document.getElementById('sound-area');
            const videoArea = document.getElementById('video-area');
            
            soundArea.style.display = 'none';
            videoArea.style.display = 'block';
            
            videoArea.innerHTML = `
                <video class="result-video" controls autoplay>
                    <source src="${q.video}" type="video/mp4">
                    <p>å‹•ç”»ã‚’å†ç”Ÿã§ãã¾ã›ã‚“ã€‚</p>
                </video>`;

            let isCorrect = (idx === q.a);
            if (isCorrect) {
                playSE('correct');
                let points = 100;
                if (isTimerMode) {
                    let bonusTime = (timeLeft === 10) ? 10 : (timeLeft + 1);
                    points += (bonusTime * 10);
                }
                score += points;
                resultMsg.innerHTML = `<span style="color:#2ecc71">æ­£è§£ï¼ +${points}ç‚¹</span>`;
                if(btn) btn.classList.add('correct-btn');
            } else {
                playSE('wrong');
                resultMsg.innerHTML = `<span style="color:#e74c3c">ä¸æ­£è§£... æ­£è§£ã¯ã€Œ${q.o[q.a]}ã€</span>`;
                if(btn) btn.classList.add('wrong-btn');
                allBtns[q.a].classList.add('correct-btn');
            }
            document.getElementById('score').innerText = score;
            allBtns.forEach(b => b.disabled = true);
            document.getElementById('next-btn').style.display = 'block';
        }

        function goNext() {
            currentIndex++;
            if (currentIndex < currentQuestions.length) loadQuestion();
            else showResult();
        }

        function showResult() {
            document.getElementById('game-screen').style.display = 'none';
            document.getElementById('final-screen').style.display = 'block';
            document.getElementById('final-score').innerText = score;
            const maxScore = currentQuestions.length * (isTimerMode ? 200 : 100);
            const rank = document.getElementById('rank-comment');
            if (score >= maxScore * 0.8) {
                rank.innerText = "ç©¶æ¥µã®ã‚µã‚¦ãƒ³ãƒ‰ãƒã‚¤ã‚¹ã‚¿ãƒ¼ï¼"; rank.style.color = "#f1c40f"; playSE('correct');
            } else if (score >= maxScore * 0.5) {
                rank.innerText = "ç«‹æ´¾ãªè»Šå¥½ãã§ã™ã­ï¼"; rank.style.color = "#2ecc71";
            } else {
                rank.innerText = "ã‚‚ã£ã¨éŸ³ã‚’èãåˆ†ã‘ã‚ˆã†ï¼"; rank.style.color = "#fff";
            }
        }

        // ==========================================
        // ğŸ’¾ ã‚¯ã‚¤ã‚ºãƒ‡ãƒ¼ã‚¿ãƒªã‚¹ãƒˆ
        // ==========================================
        const soundQuizzes = [
            { a:1, q:"é«˜éŸ³ã‚µã‚¦ãƒ³ãƒ‰", soundFile:"ãƒ©ãƒ³ãƒœãƒ«ã‚®ãƒ¼ãƒ‹ ã‚¢ãƒ´ã‚§ãƒ³ã‚¿ãƒ‰ãƒ¼ãƒ«.mp3", video:"ãƒ©ãƒ³ãƒœãƒ«ã‚®ãƒ¼ãƒ‹ ã‚¢ãƒ´ã‚§ãƒ³ã‚¿ãƒ‰ãƒ¼ãƒ«.mp4", o:["ãƒ€ãƒƒã‚¸ ãƒã‚¤ãƒ‘ãƒ¼", "ãƒ©ãƒ³ãƒœãƒ«ã‚®ãƒ¼ãƒ‹ ã‚¢ãƒ´ã‚§ãƒ³ã‚¿ãƒ‰ãƒ¼ãƒ«", "AMG GT", "ã‚³ãƒ«ãƒ™ãƒƒãƒˆ"] },
            { a:0, q:"ç‹¬ç‰¹ãªä¹¾ã„ãŸéŸ³", soundFile:"ãƒ•ã‚§ãƒ©ãƒ¼ãƒª 458.mp3", video:"ãƒ•ã‚§ãƒ©ãƒ¼ãƒª 458.mp4", o:["ãƒ•ã‚§ãƒ©ãƒ¼ãƒª 458", "ãƒã‚¹ã‚¿ãƒ³ã‚°", "ã‚¢ã‚¹ãƒˆãƒ³ãƒãƒ¼ãƒ†ã‚£ãƒ³", "ãƒ™ãƒ³ãƒˆãƒ¬ãƒ¼"] },
            { a:2, q:"ãƒ‰ãƒ­ãƒ‰ãƒ­ã¨ã—ãŸä½éŸ³", soundFile:"GTR.mp3", video:"GTR.mp4", o:["ãƒãƒ«ã‚·ã‚§ 911", "NSX", "GT-R", "ãƒ€ãƒƒã‚¸ ãƒãƒ£ãƒ¬ãƒ³ã‚¸ãƒ£ãƒ¼"] },
            { a:2, q:"èµ°ã‚Šã®ç¾å­¦", soundFile:"ãƒ¬ã‚¯ã‚µã‚¹ LC.mp3", video:"ãƒ¬ã‚¯ã‚µã‚¹ LC.mp4", o:["ã‚¹ãƒ¼ãƒ—ãƒ©", "RX-7", "ãƒ¬ã‚¯ã‚µã‚¹ LC", "ã‚·ãƒ“ãƒƒã‚¯ TypeR"] },
            { a:0, q:"å¤©ä½¿ã®å’†å“®", soundFile:"ãƒ¬ã‚¯ã‚µã‚¹ LFA.mp3", video:"ãƒ¬ã‚¯ã‚µã‚¹ LFA.mp4", o:["ãƒ¬ã‚¯ã‚µã‚¹ LFA", "ã‚¢ã‚¦ãƒ‡ã‚£ R8", "ã‚¬ãƒ¤ãƒ«ãƒ‰", "ã‚¦ãƒ©ã‚«ãƒ³"] },
            { a:1, q:"ãƒ­ãƒ¼ã‚¿ãƒªãƒ¼ã‚µã‚¦ãƒ³ãƒ‰", soundFile:"ãƒãƒ„ãƒ€ã€€787B.mp3", video:"ãƒãƒ„ãƒ€ã€€787B.mp4", o:["ãƒãƒ„ãƒ€ã€€RX-7", "ãƒãƒ„ãƒ€ã€€787B", "ãƒ©ãƒ³ã‚¨ãƒœ", "ã‚¤ãƒ³ãƒ—ãƒ¬ãƒƒã‚µ"] },
            { a:2, q:"æ°´å¹³å¯¾å‘ã‚¨ãƒ³ã‚¸ãƒ³ã®é¼“å‹•", soundFile:"ãƒãƒ«ã‚·ã‚§ 911 gt3.mp3", video:"ãƒãƒ«ã‚·ã‚§ 911 gt3.mp4", o:["86/BRZ", "ã‚¹ãƒãƒ«ã€€ãƒ¬ã‚¬ã‚·ã‚£RS", "ãƒãƒ«ã‚·ã‚§ 911 gt3", "WRX STI"] },
            { a:3, q:"æ‚ªé­”ã®éŸ³", soundFile:"ãƒ€ãƒƒã‚¸ã€€ãƒãƒ£ãƒ¬ãƒ³ã‚¸ãƒ£ãƒ¼ã€€SRTãƒ‡ãƒ¼ãƒ¢ãƒ³.mp3", video:"ãƒ€ãƒƒã‚¸ã€€ãƒãƒ£ãƒ¬ãƒ³ã‚¸ãƒ£ãƒ¼ã€€SRTãƒ‡ãƒ¼ãƒ¢ãƒ³.mp4", o:["ãƒ•ã‚©ãƒ¼ãƒ‰ã€€ãƒã‚¹ã‚¿ãƒ³ã‚°", "ã‚·ãƒœãƒ¬ãƒ¼ã€€ã‚«ãƒãƒ­", "ã‚±ãƒ¼ãƒ‹ã‚°ã‚»ã‚°", "ãƒ€ãƒƒã‚¸ã€€ãƒãƒ£ãƒ¬ãƒ³ã‚¸ãƒ£ãƒ¼ã€€SRTãƒ‡ãƒ¼ãƒ¢ãƒ³"] },
            { a:0, q:"ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ãƒ¢ãƒ¼ã‚¿ãƒ¼æ··ã˜ã‚Š", soundFile:"ãƒ›ãƒ³ãƒ€ NSX(æ–°å‹).mp3", video:"ãƒ›ãƒ³ãƒ€ NSX(æ–°å‹).mp4", o:["ãƒ›ãƒ³ãƒ€ NSX(æ–°å‹)", "ãƒ—ãƒªã‚¦ã‚¹", "i8", "ãƒ©ãƒ»ãƒ•ã‚§ãƒ©ãƒ¼ãƒª"] },
            { a:1, q:"æ¥µé™ã®é¼“å‹•", soundFile:"ãƒ•ã‚§ãƒ©ãƒ¼ãƒªF1 V12.mp3", video:"ãƒ•ã‚§ãƒ©ãƒ¼ãƒªF1 V12.mp4", o:["ãƒ•ã‚§ãƒ©ãƒ¼ãƒªF1 V6", "ãƒ•ã‚§ãƒ©ãƒ¼ãƒªF1 V12", "ãƒ•ã‚§ãƒ©ãƒ¼ãƒªF1 V10", "ãƒ•ã‚§ãƒ©ãƒ¼ãƒªF1 V8"] }
        ];
    </script>
</body>
</html>